---

- hosts: host-1
  any_errors_fatal: true
  roles:
    - system
    - lxc_bootstrap
    - lxc_local
  vars:
    monitoring_use_nrpe: false
    monitoring_use_consul: false

    metrics_use_telegraf: false

    logs_send_messages: false

    container:
      type: os # postgres,elasticsearch,mysql,mongodb,os
      name: my-container # Container's hostname
      # Pour chaque interface, on donne le câblage
      ips:
        # Définir les info uniquement pour la patte publique
        - interface: public
          vlan: %%public_vlan%%
          bridge: front
          address: x.x.x.x
          network: x.x.x.x
          prefix: xx
        - interface: save
          vlan: "{{ vlan_save }}"
          bridge: back
          address: x.x.x.x
          network: x.x.x.x
          prefix: xx
        - interface: admin
          vlan: "{{ vlan_admin }}"
          bridge: admin
          address: x.x.x.x
          network: x.x.x.x
          prefix: xx
      resources:
        cpus: 2 # Thread count
        memory: 2 # RAM (GB)
      storage:
        lun: /dev/mapper/3253546
        filesystems:
          # /tmp size, in GB
          - lv: tmp
            size: 2
            fstype: tmpfs
            mountpoint: /tmp

- hosts: cluster_group_1
  any_errors_fatal: true
  roles:
    - cluster
  vars:
    # Mandatory
    cluster_name: db-cluster-1
    cluster_expected_nodes: 3
    cluster_compute_nodes: 3

    # Optional: quorum
    cluster_no_quorum_policy: stop # stop, freeze, fence, ignore

    # Optional: resource allocation
    cluster_allocation_vcpus_ratio: 0.8
    cluster_allocation_memory_ratio: 0.8

    # Optional: networking
    ovs_front_port: bond-front
    ovs_back_port: bond-back
    ovs_admin_port: bond-admin
    ovs_cluster_port: bond-cluster

    ovs_front_vlans: 10,20,30
    ovs_back_vlans: 100,300
    ovs_admin_vlans: 1,2
    ovs_cluster_vlan: 42

    # Optional: configure hawk
    cluster_use_hawk: true # default is false
    cluster_hawk_file_key: /tmp/hawk.key
    cluster_hawk_file_pem: /tmp/hawk.pem

    # Optional: configure STONITH-base device
    cluster_stonith_use_sbd: true # default is false
    cluster_stonith_sbd_lun_1: /dev/mapper/1234
    cluster_stonith_sbd_lun_2: /dev/mapper/4567
    cluster_stonith_sbd_lun_3: /dev/mapper/8901
