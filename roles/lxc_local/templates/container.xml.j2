<!--
{{ ansible_managed }}
-->

<domain type='lxc'>
  <name>{{ application.name }}</name>

  <title>{{ application.name }}</title>

  <memory unit='GiB'>{{ application.resources.memory }}</memory>
  <currentMemory unit='GiB'>{{ application.resources.memory }}</currentMemory>
  <vcpu placement='static' cpuset='{{ custom_cpuset.stdout }}'>{{ application.resources.cpus }}</vcpu>

  <os>
    <type arch='x86_64'>exe</type>
    <init>/sbin/init</init>
  </os>
<!--
  <idmap>
    <uid start='0' target='1000' count='10'/>
    <gid start='0' target='1000' count='10'/>
  </idmap>
-->
  <features>
    <privnet/>
  </features>

  <clock offset='utc'/>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>restart</on_crash>
  <devices>

    <emulator>/usr/lib64/libvirt/libvirt_lxc</emulator>

    <filesystem type='mount' accessmode='passthrough'>
      <source dir='/srv/cluster/{{ application.name }}'/>
      <target dir='/'/>
    </filesystem>

		<filesystem type='mount' accessmode='passthrough'>
			<source dir='/opt/TimeNavigator'/>
			<target dir='/opt/TimeNavigator'/>
			<readonly/>
		</filesystem>

    <console type='pty'>
      <target type='lxc' port='0'/>
    </console>

{% for item in application.ips  %}
    <interface type='network'>
      <source network='ovs-network-{{ item.vlan }}' portgroup='vlan-{{ item.vlan }}'/>
      <guest dev='{{ item.interface }}'/>
    </interface>
{% endfor %}

  </devices>
</domain>
