# Copyright (C) 2016 Mathieu Grzybek
#
# License: GNU General Public License (GPL)
---
- version: 2.2
  category: Cluster
  shortdesc: Deploy management resources.
  longdesc: |
    Deploy a floating IP and Hawk.
    A management resource group is created.
    Location is set by 'attribute_name' and 'attribute_value'.

  parameters:
   - name: ipaddr
     shortdesc: Adresse IP
     longdesc: Adresse de management
     required: true
     type: ip_address

   - name: use_hawk
     shortdesc: Declare Hawk.
     longdesc: Do we add a resource for Hawk?
     required: false
     type: boolean
     default: false

   - name: attribute_name
     shortdesc: Attribute to check for placement.
     longdesc: Attribute to check for placement.
     required: true
     type: string

   - name: attribute_value
     shortdesc: Value to test.
     longdesc: Value to test.
     required: true
     type: string

  include:
    - script: virtual-ip
      parameters:
        - name: id
          value: mgmt_ip_addr
        - name: ip
          value: "{{ipaddr}}"
  actions:
    - include: virtual-ip
    - cib: |
       location loc_mgmt mgmt_ip_addr resource-discovery=always
          rule -inf: {{attribute_name}} ne {{attribute_value}}
